# Implementation Tasks: Add Demo Mode Switching

## Task Checklist

### Phase 1: Update .env.example Documentation

- [x] **Task 1.1**: Add TTS provider section to .env.example
  - File: `apps/voice-gateway-oww/.env.example`
  - Add `TTS_PROVIDER` environment variable documentation
  - Document valid values: 'ElevenLabs' (cloud) or 'Piper' (local)
  - Add comment explaining default is ElevenLabs
  - **Validation**: TTS_PROVIDER clearly documented with both options ‚úÖ
  - **Status**: Already complete - .env.example lines 104-150 have comprehensive TTS documentation

- [x] **Task 1.2**: Add Piper TTS configuration section
  - File: `apps/voice-gateway-oww/.env.example`
  - Add "Piper TTS Configuration (Local)" section after ElevenLabs section
  - Document TTS_MODEL_PATH with default value
  - Document Piper dependencies: Python 3 + piper-tts
  - Add installation command: `pip install piper-tts`
  - **Validation**: Piper config section exists with all required vars ‚úÖ
  - **Status**: Already complete - .env.example lines 139-150 document Piper TTS

- [x] **Task 1.3**: Reorganize AI/TTS sections with headers
  - Add section headers with visual separators (===)
  - Group AI Provider Configuration together
  - Group TTS Provider Configuration together
  - Add comments explaining online vs offline for each
  - **Validation**: .env.example has clear AI and TTS sections ‚úÖ
  - **Status**: Already complete - .env.example has clear sections with ==== separators

### Phase 2: Create Demo Preset Files

- [x] **Task 2.1**: Create .env.offline preset
  - File: `apps/voice-gateway-oww/.env.offline` (new)
  - Set AI_PROVIDER=ollama
  - Set TTS_PROVIDER=Piper
  - Set TTS_MODEL_PATH=models/piper/en_US-amy-medium.onnx
  - Include all other required env vars from .env.example
  - Add header comment: "Offline Demo Mode - No Internet Required"
  - **Validation**: File exists, uses Ollama + Piper, includes all vars ‚úÖ

- [x] **Task 2.2**: Create .env.online preset
  - File: `apps/voice-gateway-oww/.env.online` (new)
  - Set AI_PROVIDER=anthropic
  - Set TTS_PROVIDER=ElevenLabs
  - Include API key placeholders (your_api_key_here)
  - Add header comment: "Online Demo Mode - Cloud-Based AI and TTS"
  - **Validation**: File exists, uses Anthropic + ElevenLabs ‚úÖ

- [x] **Task 2.3**: Create .env.hybrid-a preset
  - File: `apps/voice-gateway-oww/.env.hybrid-a` (new)
  - Set AI_PROVIDER=ollama (local AI)
  - Set TTS_PROVIDER=ElevenLabs (cloud TTS)
  - Add header comment: "Hybrid Mode A - Local AI + Cloud TTS"
  - **Validation**: File exists, uses Ollama + ElevenLabs ‚úÖ

- [x] **Task 2.4**: Create .env.hybrid-b preset
  - File: `apps/voice-gateway-oww/.env.hybrid-b` (new)
  - Set AI_PROVIDER=anthropic (cloud AI)
  - Set TTS_PROVIDER=Piper (local TTS)
  - Add header comment: "Hybrid Mode B - Cloud AI + Local TTS"
  - **Validation**: File exists, uses Anthropic + Piper ‚úÖ

- [ ] **Task 2.5**: Add .gitignore entry for .env.tmp
  - File: `apps/voice-gateway-oww/.gitignore`
  - Add .env.tmp (generated by switch-mode.sh)
  - Verify .env.offline, .env.online, .env.hybrid-* ARE committed
  - **Validation**: .env.tmp ignored, presets committed

### Phase 3: Mode Switching Script

- [x] **Task 3.1**: Create switch-mode.sh script
  - File: `apps/voice-gateway-oww/switch-mode.sh` (new)
  - Accept argument: offline | online | hybrid-a | hybrid-b
  - Validate argument and show usage if missing
  - Check if .env.$MODE file exists
  - Copy .env.$MODE to .env.tmp
  - Print success message with restart instructions
  - **Validation**: Script exists, executable, accepts 4 modes ‚úÖ
  - **Status**: Already complete - script exists with comprehensive features including API key validation

- [x] **Task 3.2**: Make script executable
  - Run: `chmod +x apps/voice-gateway-oww/switch-mode.sh`
  - Test script with invalid argument (should show usage)
  - Test script with valid argument (should copy file)
  - **Validation**: Script is executable, handles errors gracefully ‚úÖ

- [ ] **Task 3.3**: Test mode switching workflow
  - Run: `./switch-mode.sh offline`
  - Verify .env.tmp exists and contains offline config
  - Run: `./switch-mode.sh online`
  - Verify .env.tmp updated to online config
  - **Validation**: Switching between modes works
  - **Status**: Pending user testing

### Phase 4: Provider Health Checks (Optional)

- [ ] **Task 4.1**: Create ProviderHealthCheck.js module
  - File: `apps/voice-gateway-oww/src/util/ProviderHealthCheck.js` (new)
  - Export validateProviders(config, logger) function
  - Return health status for AI and TTS providers
  - **Validation**: Module exports validateProviders function

- [ ] **Task 4.2**: Implement AI provider health checks
  - Check Anthropic: API key exists
  - Check Ollama: Server reachable at baseUrl/api/tags
  - Return { provider, healthy, error } for each
  - **Validation**: Both AI providers have health checks

- [ ] **Task 4.3**: Implement TTS provider health checks
  - Check ElevenLabs: API key exists
  - Check Piper: Import checkPiperHealth from piperTTS.js
  - Return { provider, healthy, error } for each
  - **Validation**: Both TTS providers have health checks

- [ ] **Task 4.4**: Add health check to main.js startup
  - File: `apps/voice-gateway-oww/src/main.js`
  - Import validateProviders from ProviderHealthCheck.js
  - Call validateProviders(config, logger) before initialization
  - Log health check results
  - Warn if providers unhealthy, but don't crash
  - **Validation**: Health check runs on startup, logs results

### Phase 5: Documentation Updates

- [x] **Task 5.1**: Add Demo Modes section to README
  - File: `apps/voice-gateway-oww/README.md`
  - Add "## Demo Modes" section after Quick Start
  - Document all 4 modes with emojis: üîå Offline, ‚òÅÔ∏è Online, üîÑ Hybrid A, üîÑ Hybrid B
  - Include dependencies, setup commands, use cases for each
  - Add "Quick Switch" subsection with ./switch-mode.sh usage
  - **Validation**: README explains all 4 modes clearly ‚úÖ
  - **Status**: Already complete - README lines 154-228 have comprehensive demo modes section

- [ ] **Task 5.2**: Update TECH-STACK.md
  - File: `docs/TECH-STACK.md`
  - Add "Demo Modes" section under Voice Gateway
  - Create table with Mode | AI | TTS | Dependencies | Use Case
  - Document that modes are configuration-driven (no code changes)
  - **Validation**: TECH-STACK.md documents demo modes

- [ ] **Task 5.3**: Update voice-gateway-quickstart.md
  - File: `docs/voice-gateway-quickstart.md`
  - Add "Switching Demo Modes" section
  - Explain how to use ./switch-mode.sh
  - List which dependencies are needed for which mode
  - **Validation**: Quickstart mentions mode switching

- [ ] **Task 5.4**: Update CLAUDE.md with demo mode info
  - File: `CLAUDE.md`
  - Add note about 4 demo modes being configuration-driven
  - Remind AI not to hardcode provider choices
  - **Validation**: CLAUDE.md mentions demo modes

### Phase 6: Testing All 4 Modes

#### Offline Mode Tests (Ollama + Piper)

- [ ] **Test 6.1**: Offline mode configuration
  - Run: `./switch-mode.sh offline && npm run dev`
  - Verify: AI_PROVIDER=ollama logged on startup
  - Verify: TTS_PROVIDER=Piper logged on startup
  - **Pass criteria**: Both providers show as offline/local

- [ ] **Test 6.2**: Offline mode functionality
  - Trigger wake word
  - Ask: "What time is it?"
  - Verify: Ollama processes query (check logs for ollama baseUrl)
  - Verify: Piper synthesizes speech (check logs for Python subprocess)
  - Verify: Response plays through speakers
  - **Pass criteria**: Full interaction works without internet

- [ ] **Test 6.3**: Offline mode - no network dependency
  - Disconnect from internet (disable WiFi)
  - Trigger wake word
  - Ask: "What devices do I have?"
  - Verify: System continues to work (Ollama + Piper both local)
  - **Pass criteria**: Works completely offline

#### Online Mode Tests (Anthropic + ElevenLabs)

- [ ] **Test 6.4**: Online mode configuration
  - Set ANTHROPIC_API_KEY and ELEVENLABS_API_KEY in .env.online
  - Run: `./switch-mode.sh online && npm run dev`
  - Verify: AI_PROVIDER=anthropic logged on startup
  - Verify: TTS_PROVIDER=ElevenLabs logged on startup
  - **Pass criteria**: Both providers show as cloud/online

- [ ] **Test 6.5**: Online mode functionality
  - Trigger wake word
  - Ask: "What is the capital of France?"
  - Verify: Anthropic API called (check logs for claude model)
  - Verify: ElevenLabs synthesizes speech (check logs for voice ID)
  - Verify: High-quality voice response
  - **Pass criteria**: Cloud providers deliver high quality

- [ ] **Test 6.6**: Online mode - streaming TTS
  - Ask a longer question requiring detailed response
  - Verify: Streaming TTS works with ElevenLabs
  - Verify: Audio starts playing before full response complete
  - **Pass criteria**: Streaming works in online mode

#### Hybrid Mode A Tests (Ollama + ElevenLabs)

- [ ] **Test 6.7**: Hybrid A configuration
  - Set ELEVENLABS_API_KEY in .env.hybrid-a
  - Run: `./switch-mode.sh hybrid-a && npm run dev`
  - Verify: AI_PROVIDER=ollama
  - Verify: TTS_PROVIDER=ElevenLabs
  - **Pass criteria**: Mixed local AI + cloud TTS

- [ ] **Test 6.8**: Hybrid A functionality
  - Trigger wake word
  - Ask: "Turn on Switch One"
  - Verify: Ollama processes query (local, fast)
  - Verify: ElevenLabs synthesizes speech (cloud, high quality)
  - **Pass criteria**: Local AI with cloud TTS quality

#### Hybrid Mode B Tests (Anthropic + Piper)

- [ ] **Test 6.9**: Hybrid B configuration
  - Set ANTHROPIC_API_KEY in .env.hybrid-b
  - Verify Python + piper-tts installed
  - Run: `./switch-mode.sh hybrid-b && npm run dev`
  - Verify: AI_PROVIDER=anthropic
  - Verify: TTS_PROVIDER=Piper
  - **Pass criteria**: Mixed cloud AI + local TTS

- [ ] **Test 6.10**: Hybrid B functionality
  - Trigger wake word
  - Ask complex question: "Explain how Z-Wave devices work"
  - Verify: Anthropic API called (cloud, smart response)
  - Verify: Piper synthesizes speech (local, private)
  - **Pass criteria**: Cloud AI quality with local TTS privacy

#### Health Check Tests

- [ ] **Test 6.11**: Health check - missing Anthropic API key
  - Set AI_PROVIDER=anthropic
  - Unset ANTHROPIC_API_KEY
  - Start service
  - Verify: Warning logged about missing API key
  - Verify: Service continues to start (doesn't crash)
  - **Pass criteria**: Graceful warning, no crash

- [ ] **Test 6.12**: Health check - Ollama not running
  - Set AI_PROVIDER=ollama
  - Stop Ollama service
  - Start voice gateway
  - Verify: Warning logged about Ollama unreachable
  - Verify: Service continues to start
  - **Pass criteria**: Graceful warning, no crash

- [ ] **Test 6.13**: Health check - Piper not installed
  - Set TTS_PROVIDER=Piper
  - Rename piper installation (simulate missing)
  - Start service
  - Verify: Warning about Piper not available
  - Verify: Service continues to start
  - **Pass criteria**: Graceful warning, no crash

### Phase 7: Demo Preparation

- [ ] **Task 7.1**: Create demo script for presentation
  - File: `docs/DEMO-SCRIPT.md` (new)
  - Script for switching modes during CodeMash presentation
  - Include commands and expected outputs
  - Add "what to say" for each demo
  - **Validation**: Demo script exists, covers all modes

- [ ] **Task 7.2**: Test complete demo workflow
  - Follow DEMO-SCRIPT.md from start to finish
  - Verify smooth transitions between modes
  - Time each mode switch (should be < 30 seconds)
  - **Validation**: Complete demo workflow tested

- [ ] **Task 7.3**: Prepare fallback plan
  - Document what to do if Ollama/Piper fails during demo
  - Document what to do if API keys fail
  - Add troubleshooting quick reference
  - **Validation**: Fallback plan documented

## Dependencies

- **Sequential**: Phase 1 ‚Üí Phase 2 (presets need documented vars)
- **Sequential**: Phase 2 ‚Üí Phase 3 (script needs presets)
- **Parallel**: Phase 4 (health checks) can be done alongside Phase 1-3
- **Sequential**: Phase 1-4 ‚Üí Phase 5 (docs need implementation complete)
- **Sequential**: Phase 5 ‚Üí Phase 6 (test after docs updated)
- **Sequential**: Phase 6 ‚Üí Phase 7 (demo prep needs working modes)

## Estimated Effort

- Phase 1 (Documentation): ~1 hour
- Phase 2 (Presets): ~1 hour
- Phase 3 (Script): ~1 hour
- Phase 4 (Health Checks): ~2 hours
- Phase 5 (Docs): ~2 hours
- Phase 6 (Testing): ~4 hours
- Phase 7 (Demo Prep): ~1 hour
- **Total: ~12 hours**

## Success Criteria

All tasks checked ‚úÖ AND:
1. .env.example documents both AI and TTS provider options clearly
2. 4 preset files exist (.env.offline, .env.online, .env.hybrid-a, .env.hybrid-b)
3. switch-mode.sh script works for all 4 modes
4. README explains all 4 demo modes with setup instructions
5. Health checks validate provider requirements on startup
6. All 4 modes tested and working:
   - Offline: Ollama + Piper works without internet
   - Online: Anthropic + ElevenLabs works with API keys
   - Hybrid A: Ollama + ElevenLabs works
   - Hybrid B: Anthropic + Piper works
7. Demo script prepared for CodeMash presentation
8. No code changes to existing runtime logic (configuration-driven only)
9. All modes can be switched in < 30 seconds (copy preset + restart)
10. Documentation updated across README, TECH-STACK.md, CLAUDE.md
